分割点是当前分支和给定分支头的最新共同祖先：  
- 共同祖先是指：从两个分支的头提交都存在一条（长度为 0 或更多父指针的）路径可以到达的提交。  
- 最新共同祖先（latest common ancestor）是指：它是共同祖先，但不是任何其他共同祖先的祖先。  

例如，虽然上图中最左边的提交是 master 和 branch 的共同祖先，但它还是紧接着它右边那个提交的祖先，所以它不是最新共同祖先。  

如果分割点与给定分支的提交相同，则不做任何事情；合并完成，并输出信息：  
**“Given branch is an ancestor of the current branch.”**  

如果分割点与当前分支的提交相同，则效果是检出给定分支，并输出信息：  
**“Current branch fast-forwarded.”**  

否则，继续执行以下步骤：  

- 任何在给定分支中自分割点以来被修改、但在当前分支中自分割点以来未被修改的文件，应更改为给定分支中的版本（从给定分支头提交检出）。这些文件随后应自动加入暂存区。  
  为了明确说明，如果一个文件在“给定分支自分割点以来被修改”，意味着该文件在给定分支头提交里的内容与其在分割点时的内容不同。记住：blob 是内容可寻址的！  

- 任何在当前分支中被修改、但在给定分支中未被修改的文件，应保持不变。  

- 任何在两个分支中都以相同方式被修改（即文件内容相同，或都被删除）的文件，保持不变。如果文件在两个分支中都被删除，但工作目录中存在同名文件，它保持原样，不被跟踪或暂存。  

- 任何在分割点不存在、且仅在当前分支中存在的文件，保持不变。  

- 任何在分割点不存在、且仅在给定分支中存在的文件，应被检出并暂存。  

- 任何在分割点存在、在当前分支未修改、但在给定分支不存在的文件，应被删除（且不再被跟踪）。  

- 任何在分割点存在、在给定分支未修改、但在当前分支不存在的文件，保持不存在。  

- 任何在当前分支和给定分支中以不同方式被修改的文件，都被视为冲突。  
  “以不同方式修改”指以下情况之一：  
  文件内容在两个分支中都被更改且不同；  
  一个分支更改了文件而另一个删除了文件；  
  文件在分割点不存在，但在两个分支中的内容不同。  

此时，将冲突文件内容替换为以下格式，并暂存结果：  

```
<<<<<<< HEAD
当前分支中文件的内容
=======
给定分支中文件的内容
>>>>>>>
```

（将“当前分支中文件的内容”“给定分支中文件的内容”替换为实际内容）。  
把被删除的文件视为空文件。直接串联这两部分文本即可。  
如果文件末尾没有换行符，结果可能类似于：

```
<<<<<<< HEAD
contents of file in current branch=======
contents of file in given branch>>>>>>>
```

这是允许的；那些不知道行终止符与行分隔符区别的人导致这种非标准文件，自作自受。  

当所有文件根据上述规则更新后，且分割点既不是当前分支也不是给定分支时，合并会自动生成一次提交，其日志信息为：  
**“Merged [given branch name] into [current branch name].”**  

如果合并过程中出现冲突，在终端（不是日志）输出：  
**“Encountered a merge conflict.”**  

合并提交与其他提交不同：它记录了两个父提交，  
第一个父提交为当前分支的头，  
第二个父提交为命令行中要合并的给定分支的头。  

此命令有视频演示可供参考。  

顺便提一句，我们希望你已经注意到，所有提交的结构已经从一个简单的序列演变成树，最后变成了完整的有向无环图（DAG）。  

**运行时间：** O(N log N + D)  
其中 N 是两个分支的所有祖先提交总数，D 是这些提交下所有文件的数据总量。  

**失败情况：**  
- 如果存在已暂存的增加或删除，打印：**“You have uncommitted changes.”** 并退出。  
- 若给定名称的分支不存在，打印：**“A branch with that name does not exist.”**  
- 若尝试将一个分支与自身合并，打印：**“Cannot merge a branch with itself.”**  
- 若合并生成的提交无任何更改，让普通的提交错误信息直接输出即可。  
- 若当前提交中存在未跟踪文件，会被合并操作覆盖或删除，则打印：  
  **“There is an untracked file in the way; delete it, or add and commit it first.”** 并退出；  
  此检查应在执行任何操作前进行。